<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>API Gateway - Teste Interativo</title>
  <link rel="stylesheet" href="/ui/styles.css">
</head>
<body>
  <div id="login" class="card" style="max-width:400px;margin:40px auto;">
    <h3>🔐 Login</h3>
    <input id="username" type="text" placeholder="Usuário" class="login-input" />
    <input id="password" type="password" placeholder="Senha" class="login-input" />
    <button onclick="login()">Entrar</button>
    <div id="loginStatus" class="muted" style="margin-top:10px"></div>
  </div>

  <!-- Modal para buscar documento -->
  <div id="searchModal" class="modal" onclick="closeSearchModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">🔍 Buscar Documento</div>
      <div class="info-text">Digite o ID do documento que deseja encontrar:</div>
      <input type="text" id="docIdInput" class="modal-input" placeholder="Ex: a1b2c3d4" />
      <div class="modal-buttons">
        <button class="modal-btn secondary" onclick="closeSearchModal()">Cancelar</button>
        <button class="modal-btn primary" onclick="executeSearch()">Buscar</button>
      </div>
    </div>
  </div>

  <!-- Modal para buscar processo -->
  <div id="processModal" class="modal" onclick="closeProcessModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">🔍 Buscar Processo</div>
      <div class="info-text">Digite o ID do processo para ver o resumo completo:</div>
      <input type="text" id="processIdInput" class="modal-input" placeholder="Ex: PROC-001, UI-01" />
      <div class="modal-buttons">
        <button class="modal-btn secondary" onclick="closeProcessModal()">Cancelar</button>
        <button class="modal-btn primary" onclick="executeProcessSearch()">Buscar Resumo</button>
      </div>
    </div>
  </div>

  <!-- Modal para excluir documento -->
  <div id="deleteModal" class="modal" onclick="closeDeleteModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">🗑️ Excluir Documento</div>
      <div class="info-text">Digite o ID do documento que deseja excluir:</div>
      <div class="warning-text">⚠️ Esta ação não pode ser desfeita!</div>
      <input type="text" id="deleteIdInput" class="modal-input" placeholder="Ex: a1b2c3d4" />
      <div class="modal-buttons">
        <button class="modal-btn secondary" onclick="closeDeleteModal()">Cancelar</button>
        <button class="modal-btn danger" onclick="executeDelete()">Excluir</button>
      </div>
    </div>
  </div>

  <!-- Modal para excluir prazo -->
  <div id="deleteDeadlineModal" class="modal" onclick="closeDeleteDeadlineModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">🗑️ Excluir Prazo</div>
      <div class="info-text">Digite o ID do prazo que deseja excluir:</div>
      <div class="warning-text">⚠️ Esta ação não pode ser desfeita!</div>
      <input type="text" id="deleteDeadlineIdInput" class="modal-input" placeholder="Ex: a1b2c3d4" />
      <div class="modal-buttons">
        <button class="modal-btn secondary" onclick="closeDeleteDeadlineModal()">Cancelar</button>
        <button class="modal-btn danger" onclick="executeDeleteDeadline()">Excluir</button>
      </div>
    </div>
  </div>

  <!-- Modal para excluir audiência -->
  <div id="deleteHearingModal" class="modal" onclick="closeDeleteHearingModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">🗑️ Cancelar Audiência</div>
      <div class="info-text">Digite o ID da audiência que deseja cancelar:</div>
      <div class="warning-text">⚠️ Esta ação não pode ser desfeita!</div>
      <input type="text" id="deleteHearingIdInput" class="modal-input" placeholder="Ex: a1b2c3d4" />
      <div class="modal-buttons">
        <button class="modal-btn secondary" onclick="closeDeleteHearingModal()">Cancelar</button>
        <button class="modal-btn danger" onclick="executeDeleteHearing()">Cancelar Audiência</button>
      </div>
    </div>
  </div>

  <!-- Modal para criar documento -->
  <div id="createDocumentModal" class="modal" onclick="closeCreateDocumentModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">📄 Criar Documento</div>
      <div class="info-text">Preencha as informações do documento:</div>
      <input type="text" id="docTitleInput" class="modal-input" placeholder="Título do documento" />
      <textarea id="docContentInput" class="modal-input" placeholder="Conteúdo do documento" rows="4"></textarea>
      <input type="text" id="docAuthorInput" class="modal-input" placeholder="Autor" />
      <input type="text" id="docProcessIdInput" class="modal-input" placeholder="ID do Processo (opcional)" />
      <div class="modal-buttons">
        <button class="modal-btn secondary" onclick="closeCreateDocumentModal()">Cancelar</button>
        <button class="modal-btn primary" onclick="executeCreateDocument()">Criar Documento</button>
      </div>
    </div>
  </div>

  <!-- Modal para criar prazo -->
  <div id="createDeadlineModal" class="modal" onclick="closeCreateDeadlineModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">⏰ Criar Prazo</div>
      <div class="info-text">Preencha as informações do prazo:</div>
      <input type="text" id="deadlineProcessIdInput" class="modal-input" placeholder="ID do Processo" />
      <input type="date" id="deadlineDateInput" class="modal-input" />
      <textarea id="deadlineDescInput" class="modal-input" placeholder="Descrição do prazo" rows="3"></textarea>
      <div class="modal-buttons">
        <button class="modal-btn secondary" onclick="closeCreateDeadlineModal()">Cancelar</button>
        <button class="modal-btn primary" onclick="executeCreateDeadline()">Criar Prazo</button>
      </div>
    </div>
  </div>

  <!-- Modal para agendar audiência -->
  <div id="createHearingModal" class="modal" onclick="closeCreateHearingModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">🏛️ Agendar Audiência</div>
      <div class="info-text">Preencha as informações da audiência:</div>
      <input type="text" id="hearingProcessIdInput" class="modal-input" placeholder="ID do Processo" />
      <input type="date" id="hearingDateInput" class="modal-input" />
      <input type="text" id="hearingCourtroomInput" class="modal-input" placeholder="Sala da audiência" />
      <textarea id="hearingDescInput" class="modal-input" placeholder="Descrição da audiência" rows="3"></textarea>
      <div class="modal-buttons">
        <button class="modal-btn secondary" onclick="closeCreateHearingModal()">Cancelar</button>
        <button class="modal-btn primary" onclick="executeCreateHearing()">Agendar Audiência</button>
      </div>
    </div>
  </div>

  <div id="mainUI" style="display:none;" class="container">
    <div class="header">
      <h1>🚀 API Gateway - SOA Microserviços</h1>
      <div class="muted">UI de teste servida pelo próprio gateway em <code>/ui</code></div>
    </div>

    <div class="toolbar">
      <button class="secondary" data-permission="read" onclick="hit('/health','GET')">💚 Health</button>
      <button data-permission="write" onclick="hit('/api/seed','POST')">🌱 Popular com dados de exemplo (seed)</button>
      <button class="secondary" onclick="logout()">🚪 Sair</button>
    </div>
    <div id="userInfo" class="muted" style="text-align:center;margin-bottom:18px"></div>
    <div id="status" class="statusline">Aguardando...</div>

    <div class="grid">
      <div class="card">
        <h3>📄 Documentos</h3>
        <div class="btns">
          <button data-permission="read" onclick="hit('/api/documents','GET')" title="Apenas lista os documentos existentes">📋 Listar Documentos</button>
          <button data-permission="write" onclick="createDocument()" title="Cria um novo documento">➕ Criar Documento</button>
          <button data-permission="read" onclick="searchDocument()" title="Busca um documento por ID">🔍 Buscar Documento</button>
          <button data-permission="delete" onclick="deleteDocument()" title="Exclui um documento por ID">🗑️ Excluir Documento</button>
        </div>
      </div>
      <div class="card">
        <h3>⏰ Prazos</h3>
        <div class="btns">
          <button data-permission="read" onclick="hit('/api/deadlines','GET')">Listar Prazos</button>
          <button data-permission="write" onclick="createDeadlineModal()">Criar Prazo</button>
          <button data-permission="read" onclick="hit('/api/deadlines/today','GET')">Prazos de Hoje</button>
          <button data-permission="delete" onclick="deleteDeadline()">Excluir Prazo</button>
        </div>
      </div>
      <div class="card">
        <h3>🏛️ Audiências</h3>
        <div class="btns">
          <button data-permission="read" onclick="hit('/api/hearings','GET')" title="Apenas lista as audiências existentes">📋 Listar Audiências</button>
          <button data-permission="write" onclick="createHearingModal()" title="Agenda uma nova audiência">➕ Agendar Audiência</button>
          <button data-permission="read" onclick="hit('/api/hearings/today','GET')" title="Lista audiências de hoje">📅 Audiências de Hoje</button>
          <button data-permission="delete" onclick="deleteHearing()" title="Cancela uma audiência por ID">🗑️ Cancelar Audiência</button>
        </div>
      </div>
      <div class="card">
        <h3>⚖️ Processos</h3>
        <div class="btns">
          <button data-permission="read" onclick="listProcesses()">Listar Processos</button>
          <button data-permission="read" onclick="searchProcess()">Buscar Processo</button>
          <button data-permission="orchestrate" onclick="orchestrateCase()">Orquestrar (Criar tudo)</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="response-header">
        <h3>📊 Resposta da API</h3>
        <div>
          <span id="responseMeta" class="response-meta"></span>
          <button id="toggleView" class="toggle-view" onclick="toggleResponseView()" style="display:none;">📋 Tabela</button>
        </div>
      </div>
      <div id="out" class="result">Nenhuma requisição ainda.</div>
      <div id="tableView" style="display:none;"></div>
    </div>
  </div>

  <script src="/ui/script.js"></script>
</body>
</html>